<section class="sidebar">
    <!-- Sidebar Menu -->
    <div id="sidebar">
        <Row>
            <Col span="8">
            <i-menu theme="dark" accordion="true" :active-name="activeMenu" :open-names="openMenu" @on-select="onSelectSubMenu">
                <Submenu :name="menu_idx" v-for="(menu, menu_idx) in menuList">
                    <template slot="title">
                        <Icon type="ios-paper"></Icon>{{menu.TitleCn}}
                    </template>
                    <Menu-item :name="menu_idx + '-' + sub_menu_idx" v-for="(subMenu, sub_menu_idx) in menu.Sons" >
                        <div :name="menu_idx + '-' + sub_menu_idx"></div>
                        {{subMenu.TitleCn}}
                    </Menu-item>
                </Submenu>
            </i-menu>
            </Col>
        </Row>

        <Col span="8">
        <i-menu theme="dark" :active-name="activeMenu"  :open-names="openMenu" >
            <Submenu name="1">
                <template slot="title">
                    <Icon type="ios-paper"></Icon>
                    内容管理
                </template>
                <Menu-item name="1-1">文章管理</Menu-item>
                <Menu-item name="1-2">评论管理</Menu-item>
                <Menu-item name="1-3">举报管理</Menu-item>
            </Submenu>
            <Submenu name="2">
                <template slot="title">
                    <Icon type="ios-people"></Icon>
                    用户管理
                </template>
                <Menu-item name="2-1">新增用户</Menu-item>
                <Menu-item name="2-2">活跃用户</Menu-item>
            </Submenu>
            <Submenu name="3">
                <template slot="title">
                    <Icon type="stats-bars"></Icon>
                    统计分析
                </template>
                <Menu-group title="使用">
                    <Menu-item name="3-1">新增和启动</Menu-item>
                    <Menu-item name="3-2">活跃分析</Menu-item>
                    <Menu-item name="3-3">时段分析</Menu-item>
                </Menu-group>
                <Menu-group title="留存">
                    <Menu-item name="3-4">用户留存</Menu-item>
                    <Menu-item name="3-5">流失用户</Menu-item>
                </Menu-group>
            </Submenu>
        </i-menu>
        </Col>
    </div>
</section>

<script>
    new Vue({
        el: '#sidebar',
        data: {
            menuList : '',
            activeMenu: '1-2',
            openMenu: "['1']"
        },
        created(){

        },
        methods: {
            onSelectSubMenu(key) {
                console.log(key);
            },
            loadMenu() {
                let _this = this;
                $c.loading(this);
                $c.ajax('[[urlfor "MenuController.UserMenuTree"]]',{}, function (ret) {
                    if(ret.code === 0){
                        _this.menuList = _this.initMenu(ret.data);
                        console.log(_this.menuList);
                    }else{
                        $c.error(_this,ret.message);
                    }
                })
            },
            initMenu(data) {
                let _this = this;
                let menu = [];
                $(data).filter(function (i, e) {
                    //找出父节点
                    let is_child =  e.Parent.Id === 0;
                    if (is_child) {
                        e.Sons = [];
                        menu.push(e);
                    }
                    return is_child;
                }).each(function (i, e) {
                    //菜单
                    if (e.Type === 1) {
                        //递归加载子节点
                        _this.addSonNode(e, data);
                    } else if (e.Type === 0) {
                        //如果是区域，先添加header
                        //添加区域的子节点
                        // $(data).filter(function (i1, e1) {
                        //     return e1.Parent.Id === e.Id;
                        // }).each(function (i2, e2) {
                        //     //递归调用，显示子节点
                        //
                        // });
                    }
                });
                return menu;
            },
            //cur 是实参
            addSonNode(cur, list) {
                let _this = this;
                if (!$c.isEmpty(cur.SonNum) && cur.SonNum > 0) {
                    $(list).filter(function (i, e) {
                        let is_child =  e.Parent.Id === cur.Id;
                        if (is_child) {
                            e.Sons = [];
                            cur.Sons.push(e);
                        }
                        return is_child;
                    }).each(function (i, e) {
                        //递归调用，显示子节点
                        _this.addSonNode(e, list);
                    });
                } else {
                    cur.Sons = [];
                }
            }
        },
        mounted: function () {
            this.loadMenu();
        }
    });

</script>