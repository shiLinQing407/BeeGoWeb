<section class="sidebar">
    <!-- Sidebar Menu -->
    <div id="sidebar">
        <Row>
            <Col span="8">
            <i-menu theme="dark" accordion="true"  v-for="(menu, menu_idx) in menu_list">
                <Submenu name="1">
                    <template slot="title">
                        <Icon type="ios-paper"></Icon>
                        {{menu.TitleCn}}
                    </template>
                    <Menu-item name="1-1" v-for="(subMenu, sub_menu_idx) in menu.Sons">{{subMenu.TitleCn}}</Menu-item>
                </Submenu>
            </i-menu>
            </Col>
        </Row>
    </div>
</section>

<script>
    new Vue({
        el: '#sidebar',
        data: {
            menu_list : '',
            menu: null
        },
        created(){

        },
        methods: {
            loadMenu() {
                let _this = this;
                $c.loading(this);
                $c.ajax('[[urlfor "MenuController.UserMenuTree"]]',{}, function (ret) {
                    console.log(_this.menu_list);
                    if(ret.code === 0){
                        _this.menu_list = _this.initMenu(ret.data);
                        console.log(_this.menu_list);
                    }else{
                        $c.error(_this,ret.message);
                    }
                })
            },
            initMenu(data) {
                let _this = this;
                let menu = [];
                $(data).filter(function (i, e) {
                    //找出父节点
                    let is_child =  e.Parent.Id === 0;
                    if (is_child) {
                        e.Sons = [];
                        menu.push(e);
                    }
                    return is_child;
                }).each(function (i, e) {
                    //菜单
                    if (e.Type === 1) {
                        //递归加载子节点
                        menu[i].Sons.push(_this.addSonNode(e,data));
                        console.log(menu[i].TitleCn);
                        console.log(menu[i].Sons);
                    } else if (e.Type === 0) {
                        //如果是区域，先添加header
                        //添加区域的子节点
                        // $(data).filter(function (i1, e1) {
                        //     return e1.Parent.Id === e.Id;
                        // }).each(function (i2, e2) {
                        //     //递归调用，显示子节点
                        //
                        // });
                    }
                });
                return menu;
            },
            addSonNode(cur, list) {
                let _this = this;
                if (!$c.isEmpty(cur.SonNum) && cur.SonNum > 0) {
                    $(list).filter(function (i, e) {
                        let is_child =  e.Parent.Id === cur.Id;
                        if (is_child) {
                            e.Sons = [];
                            cur.Sons.push(e);
                            // console.log("match");
                            // console.log(e);
                        }
                        return is_child;
                    }).each(function (i, e) {
                        console.log("find child");
                        console.log(e);
                        //递归调用，显示子节点
                        cur.Sons[i].Sons.push(_this.addSonNode(e, list));
                    });
                } else {
                    cur.Sons = [];
                }
                console.log(cur.TitleCn);
                console.log(cur);
                return cur;
            }
        },
        mounted: function () {
            this.loadMenu();
        }
    });

</script>