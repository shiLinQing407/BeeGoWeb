(function(c,y){c.fn.setValue=function(l){if(0!=this.length){var u=this[0],b=u.ui,k={combosearch:function(){var a="",b="";l?(a=l[this.data_options.valueField],b=l[this.data_options.textField]):c(this).parent().removeClass("validation-succe");var d=c("#___js_"+this.id);c(this).val(a);c(this).attr("data-text",b);c(d).val(b);c(d).attr("data-value",a);(b=c(this).attr("placeholder"))||(b="");c(d).attr("placeholder",b);c(this)[0].data=l;c(this)[0].loading=!1;c(this)[0].ori_value!=a&&c(this).trigger("change");c(this)[0].ori_value=a},switch:function(){this.checked=this.value==l;var a=c(this).parent().next(".ui-switch");if(0<a.length){var b=a.attr("data-open_text"),d=a.attr("data-close_text");a.prev().find('input[type="radio"]')[0].checked?a.addClass("checked").find("em").text(b):a.removeClass("checked").find("em").text(d);return!0}},select:function(){var a=c(this).parent().find(".select-wrap");if(0<a.length){var b=a.find(".item-wrap");b.find(".select-item").removeClass("selected");b.find(".select-item[data-value='"+l+"']").addClass("selected");this.value=l;b=c(this.options[this.selectedIndex]);a.find(".select-title").find("input[type='text']").val(b.html())}},checkbox:function(){var a=c(this);if(null!=l){for(var b=(l+"").split(","),d=!1,g=0;g<b.length;g++)if(a.val()==b[g]){d=this.checked=!0;break}d||(this.checked=!1);d=a.next(".checkbox-item");b=a.parent();0<d.length&&(a=a[0],b=b.find(".checkbox-item"),a.checked?b.addClass("checked"):b.removeClass("checked"))}},radio:function(){this.checked=this.value==l;var a=c(this),b=a.next(".radio-item"),d=a.parent();0<b.length&&(a=a[0].name,c("body").find('input[name="'+a+'"]').each(function(){if(!this.checked){var a=c(this).parent();this.checked=!1;a.removeClass("checked")}}),d.addClass("checked"))}};if(b)return k[b]?k[b].call(u):!1;this.val(l)}};c.fn.ui=function(){var l=this;this.combosearch=function(b){var k=function(a,d){c(a.target).parent().hasClass("select-title")&&!d||c(".select-wrap").removeClass("open")};this.getData=function(){return c(this)[0].data};this.setValue=function(a,d,b){"undefined"!=typeof this.data_options.formatter&&(d=this.data_options.formatter.call(this,d));var g="",e="";d?(g=d[this.data_options.valueField],e=d[this.data_options.textField],g||(g=""),e||(e="")):c(this).parent().removeClass("validation-succe");c(this).val(g);c(this).attr("data-text",e);c(a).val(e);c(a).attr("data-value",g);(e=c(this).attr("placeholder"))||(e="");c(a).attr("placeholder",e);c(this)[0].data=d;c(this)[0].loading=!1;c(this)[0].ori_value!=g&&c(this).trigger("change");null==b&&(b=!0);b&&c(this).trigger("blur");c(this)[0].ori_value=g};this.loadValue=function(a){var d=null,b=c(this).next().find(".search_input");0==b.length&&(b=c(this).next().next().find(".search_input"));if(null==a||""==a)this.setValue(b,d,!1);else{var e=this.data_options.data;c(b).attr("placeholder","\u6b63\u5728\u52a0\u8f7d\u6570\u636e...");c(this)[0].loading=!0;c(this)[0].ori_value="";if(e){for(var g=e.length,f=0;f<g;f++)if(e[f][this.data_options.valueField].toString()==a){d=e[f];c(this)[0].ori_value=d[this.data_options.valueField];break}this.setValue(b,d,!1)}else if(e=this.data_options.url,""!=e){var w=this;c.ajax({dataType:"json",type:"get",url:e,data:{keyword:a,valueField:this.data_options.valueField},success:function(a){a&&(d=a,c(this)[0].ori_value=d[this.data_options.valueField]);w.setValue(b,d,!1)},error:function(){w.setValue(b,d,!1)}})}}};this.setDataSource=function(a){var d=this.data_options;if(a&&""!=a){var b=a.length;d.data=a;if(d.showList)for(var g=this.parent().find(".item-wrap").empty(),f=0;f<b;f++){e=a[f];var h=c('<dd data-value="'+e[d.valueField]+'" class="select-item '+(r===e[d.valueField]?"selected":"")+'">'+e[d.textField]+"</dd>");h[0].data=e;g.append(h)}}else d.data=null,d.showList&&this.parent().find(".item-wrap").empty()};this.appendData=function(a){if(a&&""!=a){var d=a.length,b=this.data_options;if(null==b.data||""==this.data_options.data)b.data=[];for(var g=this.parent().find(".item-wrap"),f=0;f<d;f++){e=a[f];if(b.showList){var h=c('<dd data-value="'+e[b.valueField]+'" class="select-item '+(r===e[b.valueField]?"selected":"")+'">'+e[b.textField]+"</dd>");h[0].data=e;g.append(h)}b.data.push(e)}}};var a=c(this);c(this)[0].ui="combosearch";c(this)[0].owner=this;if(!l.reRenderUI(a,"combosearch")){a.hasClass("required")&&a.parent().addClass("validation-required");a.addClass("hide");var m=c(this)[0].disabled,d={};if(b)d=b;else{(b=a.attr("data-options"))||console.log("\u672a\u914d\u7f6e\u7ec4\u4ef6\u53c2\u6570");try{d=eval("("+b+")")}catch(v){console.log("\u53c2\u6570\u9519\u8bef\uff0c"+v.message),alert(v.message)}}d.showList||(d.showList=!1);d.valueField||console.log("\u8bf7\u6307\u5b9avalueField\u5b57\u6bb5\u503c");d.textField||console.log("\u8bf7\u6307\u5b9atextField\u5b57\u6bb5\u503c");d.matchFields||(d.matchFields=[d.valueField,d.textField]);d.searchWin||(d.searchWin=null);this.data_options=d;c(this)[0].data_options=d;c(this)[0].data=null;c(this)[0].ori_value="";(b=a.attr("placeholder"))||(b="");var g="";if(d.required||a.hasClass("required"))g="required";var f=a.outerWidth()-2,n="";m&&(n="disabled");b='<span style="width:'+f+'px" class="ui-wrap ui_search_wrap '+g+'">'+('<div class="select-title"><input autocomplete="off" type="text" id="___js_'+a[0].id+'" '+n+' placeholder="'+b+'" value="" class="search_input input" />');b=d.searchWin?b+('<a href="javascript:void(0);" id="___js_'+a[0].id+'_search" class="search_bar"><i class="icon wb-search"></i></a>'):b+'<i class="edge"></i>';b=c(b+"</div></span>");var e=null,g=null;d.showList&&(b.addClass("select-wrap"),g=c('<dl class="item-wrap animation animation-slide-bottom"></dl>'),b.append(g));this.fields=[];var r=a.val();if(this.data_options.data){if(f=this.data_options.data.length,0<f){for(var q in this.data_options.data[0])this.fields.push(q);if(g)for(q=0;q<f;q++)e=this.data_options.data[q],n=c('<dd data-value="'+e[d.valueField]+'" class="select-item '+(r===e[d.valueField]?"selected":"")+'">'+e[d.textField]+"</dd>"),n[0].data=e,g.append(n)}}else if("SELECT"===a[0].tagName){var h=a.find("*"),f=h.length,p=null,t=[];for(q=0;q<f;q++)e=h[q],p={},p[d.valueField]=e.value,p[d.textField]=e.innerHTML,t.push(p),d.showList&&(b.addClass("select-wrap"),n=c('<dd data-value="'+e.value+'" class="select-item '+(r===e.value?"selected":"")+(e.disabled?" disabled":"")+'">'+e.innerHTML+"</dd>"),n[0].data=p,g.append(n));this.data_options.data=t}d.searchWin||b.addClass("no_search_bar");a.after(b);r&&""!=r&&this.loadValue(r);(function(a,d,b){var e=a.find("input"),g=a.find("dl"),f=a.find(".select-title"),h=this;e[0].owner=this;if(!d){var n=function(){a.hasClass("open")||(a.addClass("open"),g.children("dd").removeClass("hide"))};a.find(".search_bar").click(function(a){if(!c(h)[0].disabled&&!c(h)[0].loading)return a.preventDefault(),a=h.data_options.searchWin,"undefined"!=typeof a&&a.call(h,c(h)[0].data),!1});e.on("keyup",function(a){9===a.keyCode&&n()}).on("keydown",function(d){var b=d.keyCode;8!==b&&(c(h)[0].ori_value=h.value,9===b?a.removeClass("open"):13===b?d.preventDefault():n())});var m=function(a){var d=null,b=h.data_options.url;"function"==typeof b&&(b=b());if(""!=b){c(e).attr("placeholder","\u6b63\u5728\u52a0\u8f7d\u6570\u636e...");var f=h.data_options.param;"function"==typeof f&&(f=f());f?f.keyword=r:f={keyword:r};l=!0;c.ajax({dataType:"json",async:a,type:"get",url:b,data:f,success:function(b){c(e).attr("placeholder","");b&&(h.data_options.data=b);d=b;l=!1;if(a){b=h.data_options.data.length;for(var f=0;f<b;f++){var m=h.data_options.data[f],p=c('<dd data-value="'+m[h.data_options.valueField]+'" class="select-item '+(r===m[h.data_options.valueField]?"selected":"")+'">'+m[h.data_options.textField]+"</dd>");p[0].data=m;g.append(p)}n();g.find(".select-no-match").remove()}},error:function(a,d,b){l=!1;c(e).attr("placeholder","");console.log(d||b)}})}return d},p=function(a,d,b){var e=h.data_options.data,f=!0,n=!0,p=null;e||l||(e=m(!1));if(e)for(var r=e.length,k=h.data_options.matchFields,q=g.children("dd"),t=0;t<r;t++){var x=c(q[t]),v;for(v in k)if(n=-1===e[t][k[v]].toString().indexOf(a),!n){f=!1;p=x;break}"keyup"===b&&x[n?"addClass":"removeClass"]("hide")}return d(f,p),f};d=function(a){if(h.data_options.data){a=a.keyCode;if(9===a||13===a||37===a||38===a||39===a||40===a)return!1;a=this.value.trim();p(a,function(a){a?(g.children("dd").removeClass("selected"),g.find(".select-no-match")[0]||g.append('<p class="select-no-match">\u65e0\u5339\u914d\u9879</p>')):g.find(".select-no-match").remove()},"keyup");""===a&&g.find(".select-no-match").remove()}};if(b)e.on("keyup",d);var l=!1;f.on("click",function(d){h[0].disabled||a.hasClass("select-disabled")||(g&&0<g.length&&null==h.data_options.data&&!l?m(!0):(a.hasClass("open")?a.removeClass("open"):(k(d,!0),n()),g.find(".select-no-match").remove()))});f.find(".edge").on("click",function(){h[0].disabled||a.hasClass("select-disabled")||e.focus()});e.on("blur",function(a){a=c(this).val().trim();if(c(h).val()&&c(h).attr("data-text")==a&&c(h)[0].data)c(h).trigger("blur");else if(""==a)c(h)[0].data=null,h.setValue(this,c(h)[0].data);else{var d=g.find(".selected");if(1==d.length){var b=this;h.setValue(b,d[0].data);setTimeout(function(){d=g.find(".selected");1==d.length&&h.setValue(b,d[0].data)},300)}else{c(this).val("");c(this).attr("placeholder","\u6b63\u5728\u52a0\u8f7d\u6570\u636e...");c(h)[0].loading=!0;var e=null,f=h.data_options.data;if(f){for(var n=f.length,m=h.data_options.matchFields,p=!1,r=null,k=0;k<n&&!p;k++)for(var l in m)if((r=f[k][m[l]])&&r.toString()==a){e=f[k];p=!0;break}e||(c(h)[0].ori_value="");h.setValue(this,e)}else l=h.data_options.url,"function"==typeof l&&(l=l()),""!=l&&(b=this,f=h.data_options.param,"function"==typeof f&&(f=f()),f?f.keyword=a:f={keyword:a},c.ajax({dataType:"json",type:"get",async:!1,url:l,data:f,success:function(a){a&&(1==a.length&&(a=a[0]),e=a);e||(c(h)[0].ori_value="");h.setValue(b,e);c(b).trigger("loadComplete")},error:function(){e||(c(h)[0].ori_value="");h.setValue(b,e)}}))}}});a.on("click","dd",function(){if(c(this).hasClass("disabled"))return!1;g.children("dd").removeClass("selected");a.removeClass("open");h.setValue(e,this.data);c(h).trigger("blur")});a.on("click","dl>dt",function(){return!1});c(document).off("click",k).on("click",k)}}).call(this,b,m,d.showList);return b}};var u={combosearch:function(){l.find('input[data-ui="combosearch"],select[data-ui="combosearch"]').each(function(b,k){l.combosearch.call(c(this))})},switch:function(){l.find(':radio[data-ui="switch"]').each(function(b,k){b=c(this);if(!b.is(":hidden")||null!=b.attr("data-ui"))if(b.attr("data-ui","switch"),!l.reRenderUI(b)){this.ui="switch";var a=null,m=null,d="",g="";l.find(':radio[name="'+this.name+'"]').each(function(b){this.ui="switch";var f=c(this).parent().hide();0===b?(a=c(this),d=f.text()):1===b&&(m=c(this),g=f.text());0<b&&c(this).attr("data-ignore","1")});k=g;var f="";a[0].checked&&(f="checked",k=d);var n=c('<div class="ui-switch '+f+" "+(this.disabled?" disabled":"")+'" data-open_text="'+d+'" data-close_text="'+g+'"><em>'+k+"</em><i></i></div>");b.parent().after(n);n.on("click",function(){c(this).hasClass("disabled")||(a[0].checked?(m[0].checked=!0,n.removeClass("checked").find("em").text(g)):(a[0].checked=!0,n.addClass("checked").find("em").text(d)))})}})},select:function(){var b=function(a,b){c(a.target).parent().hasClass("select-title")&&!b||c(".select-wrap").removeClass("open")},k=function(a,m,d,g){var f=c(this);m=a.find(".select-title");var n=m.find("input"),e=a.find("dl"),k=function(){a.hasClass("open")||(a.addClass("open"),e.children("dd").removeClass("hide"))};m.on("click",function(d){f[0].disabled||a.hasClass("select-disabled")||(a.hasClass("open")?a.removeClass("open"):(b(d,!0),k()),e.find(".select-no-match").remove())});m.find(".edge").on("click",function(){f[0].disabled||a.hasClass("select-disabled")||n.focus()});n.on("keyup",function(a){9===a.keyCode&&k()}).on("keydown",function(d){var b=d.keyCode;9===b?a.removeClass("open"):13===b?d.preventDefault():k()});var l=function(a,d,b){for(var f=0,g=null,h=e.children("dd"),n=h.length,k=0;k<n;k++){var m=c(h[k]),l=m.text(),p=-1===l.indexOf(a);(""===a||"blur"===b?a!==l:p)?f++:g=m;"keyup"===b&&m[p?"addClass":"removeClass"]("hide")}a=f===n;return d(a,g),a};m=function(a){a=a.keyCode;if(9===a||13===a||37===a||38===a||39===a||40===a)return!1;a=this.value.trim();l(a,function(a){a?e.find(".select-no-match")[0]||e.append('<p class="select-no-match">\u65e0\u5339\u914d\u9879</p>'):e.find(".select-no-match").remove()},"keyup");""===a&&e.find(".select-no-match").remove()};if(d)n.on("keyup",m).on("blur",function(a){if(f.val()==c(this).val())c(f).trigger("blur");else{var d=this,b=e.find(".selected").html();setTimeout(function(){l(n.val(),function(a,h){a&&(g?(a=c(d).val(),h=c('<dd data-value="'+a+'" class="select-item">'+a+"</dd>"),e.append(h),f[0].options.add(new Option(a,a))):n.val(b));if(h){a=f.val();var k=h.attr("data-value");f.val(k).removeClass("form-danger");h.addClass("selected").siblings().removeClass("selected");a!=k&&c(f).trigger("change")}c(f).trigger("blur")},"blur")},200)}});a.on("click","dd",function(){var d=c(this),b=f.val(),e=d.attr("data-value");if(d.hasClass("disabled"))return!1;f.val(e).removeClass("form-danger");n.val(d.text());d.addClass("selected").siblings().removeClass("selected");a.removeClass("open");b!=e&&c(f).trigger("change");c(f).trigger("blur");return!1});a.on("click","dl>dt",function(){return!1});c(document).off("click",b).on("click",b)};l.find("select").each(function(a,b){a=c(this);if(!("combosearch"==a.attr("data-ui")||a.is(":hidden")&&null==a.attr("data-ui")||(a.attr("data-ui","select"),l.reRenderUI(a)))){this.ui="select";a.hasClass("required")&&a.parent().addClass("validation-required");a.addClass("select-hide");var d=this.disabled,g=b.value,f=c(b.options[b.selectedIndex]),n="string"===typeof a.attr("data-search"),e=!1,m=a.attr("data-editable");m&&"true"==m.toLocaleString()&&(e=!0);var m=c(b).outerWidth(),q="\u8bf7\u9009\u62e9";0<b.options.length&&(q=b.options[0].innerHTML);b=c('<div style="width:'+m+'px" class="ui-wrap select-wrap '+(d?" select-disabled":"")+'"></div>');for(var f='<div class="select-title"><input autocomplete="off" style="width:'+m+'px" type="text" placeholder="'+q+'" value="'+(g?f.html():"")+'" '+(n?"":"readonly")+' class="input '+(d?" disabled":"")+'"><i class="edge"></i></div>',f=f+('<dl class="item-wrap animation animation-slide-bottom'+(a.find("optgroup")[0]?" select-group":"")+'">'),m=a.find("*"),q=m.length,h=[],p=0;p<q;p++){var t=m[p];"optgroup"===t.tagName.toLowerCase()?h.push('<dt class="select-item-group">'+t.label+"</dt>"):h.push('<dd data-value="'+t.value+'" class="select-item '+(g===t.value?"selected":"")+(t.disabled?" disabled":"")+'">'+t.innerHTML+"</dd>")}f+=h.join("")+"</dl>";b.append(f);a.after(b);k.call(this,b,d,n,e)}})},checkbox:function(){l.find('input[type="checkbox"]').each(function(b,k){var a=c(this);if(!a.is(":hidden")||null!=a.attr("data-ui"))if(a.attr("data-ui","checkbox"),!l.reRenderUI(a,"checkbox")){this.ui="checkbox";b=a.parent();b.addClass("checkbox-item-label");var m="";k.checked&&(m=" checked");k="";this.disabled&&(k=" disabled",b.addClass("disabled"));var d=c('<div class="checkbox-item'+m+k+'"></div>');d.append('<i class="icon wb-check-mini"></i>');a.after(d);if("LABEL"==b[0].tagName)a.on("click",function(){var b=a[0];b.disabled||(b.checked?d.addClass("checked"):d.removeClass("checked"))});else b.on("click",function(){var b=a[0];b.disabled||(c(this).find(".checkbox-item").hasClass("checked")?(d.removeClass("checked"),b.checked=!1):(d.addClass("checked"),b.checked=!0))})}})},radio:function(){l.find('input[type="radio"]').each(function(b,k){var a=c(this);if(!("switch"==a.attr("data-ui")||a.is(":hidden")&&null==a.attr("data-ui")||(a.attr("data-ui","radio"),l.reRenderUI(a,"radio")))){this.ui="radio";var m=a.parent();m.addClass("radio-item-label");k.checked&&m.addClass("checked");b="";this.disabled&&(b=" disabled",m.addClass("disabled"));b=c('<div class="radio-item'+b+'"></div>');b.append('<i class="icon"></i>');a.after(b);a.on("click",function(){var b=a[0],g=l.find('input[name="'+b.name+'"]');b.disabled||(g.each(function(){if(!this.checked){var a=c(this).parent();this.checked=!1;a.removeClass("checked")}}),m.addClass("checked"))})}})}};this.reRenderUI=function(b,k){var a=null;if(b){a=c(b);if("string"===typeof a.attr("data-ignore"))return a.show(),!0;k||(k=a[0].tagName.toLocaleLowerCase(),"combosearch"==a[0].ui?k=a[0].ui:"input"==k&&(k=c(b).attr("type"),"radio"==k&&"switch"==a.attr("data-ui")&&(k="switch")))}else return this.render(k);b={combosearch:function(){var b=null,g=a.next(".validation-msg-wrap"),b=0<g.length?g.next(".ui-wrap"):a.next(".ui-wrap");if(0<b.length){var f=function(b,d,f){var e="",g="";f?(e=f[d.valueField],g=f[d.textField],e||(e=""),g||(g="")):a.next().removeClass("validation-succe");a.val(e);a.attr("data-text",g);c(b).val(g);c(b).attr("data-value",e);(d=a.attr("placeholder"))||(d="");c(b).attr("placeholder",d);a[0].data=f;a[0].loading=!1;a[0].ori_value=e},g=a.val(),n=b.find("input"),e=a[0].data_options,k=null;a.hasClass("required")&&(b.addClass("validation-required"),b.addClass("required"));c(a)[0].disabled&&c(n).attr("disabled",!0);if(null==g||""==g)return f(n,e,k),!0;b=e.data;c(n).attr("placeholder","\u6b63\u5728\u52a0\u8f7d\u6570\u636e...");a[0].loading=!0;a[0].ori_value="";if(b){for(var l=b.length,h=0;h<l;h++)if(b[h][e.valueField].toString()==g){k=b[h];a[0].ori_value=k[e.valueField];break}f(n,e,k);return!0}(b=e.url)&&""!=b&&c.ajax({dataType:"json",type:"get",url:b,data:{keyword:g,valueField:e.valueField},success:function(b){b&&(k=b,a[0].ori_value=k[e.valueField]);f(n,e,k);return!0},error:function(){f(n,e,k);return!0}})}else return!1},switch:function(){var b=a.parent().next(".ui-switch");if(0<b.length){var c=b.attr("data-open_text"),f=b.attr("data-close_text"),k=b.prev().find('input[type="radio"]')[0];k.checked?b.addClass("checked").find("em").text(c):b.removeClass("checked").find("em").text(f);k.disabled&&b.addClass("disabled");return!0}return!1},select:function(){var b=a.parent().find(".select-wrap"),g=a[0],f=g.value,g=c(g.options[g.selectedIndex]);if(0<b.length){for(var k=b.find(".item-wrap"),e=a.find("*"),l=e.length,m=[],h=0;h<l;h++){var p=e[h];"optgroup"===p.tagName.toLowerCase()?m.push("<dt>"+p.label+"</dt>"):m.push('<dd data-value="'+p.value+'" class="select-item '+(f===p.value?"selected":"")+(p.disabled?" disabled":"")+'">'+p.innerHTML+"</dd>")}k.html(m.join(""));k.find(".select-item").removeClass("selected");k.find(".select-item[data-value='"+f+"']").addClass("selected");k=b.find(".select-title").find("input[type='text']");k.val(f?g.html():"");a[0].disabled?(b.addClass("select-disabled"),k.addClass("disabled")):(b.removeClass("select-disabled"),k.removeClass("disabled"));return!0}return!1},checkbox:function(){var b=a.next(".checkbox-item"),c=a.parent();if(0<b.length){var b=a[0],f=c.find(".checkbox-item");b.checked?f.addClass("checked"):f.removeClass("checked");a[0].disabled?(c.addClass("disabled"),f.addClass("disabled")):(c.removeClass("disabled"),f.removeClass("disabled"));return!0}return!1},radio:function(){var b=a.next(".radio-item"),g=a.parent();return 0<b.length?(b=a[0].name,c("body").find('input[name="'+b+'"]').each(function(){var a=c(this).parent();this.checked?(this.checked=!0,a.addClass("checked")):(this.checked=!1,a.removeClass("checked"))}),a[0].disabled?g.addClass("disabled"):g.removeClass("disabled"),!0):!1}};if(k)return b[k]?b[k].call(this):!1;for(var l in b)return b[l].call(this)};this.render=function(b){if(b){if(u[b])return u[b].call(this);alert("\u4e0d\u652f\u6301\u7684\u7c7b\u578b"+b)}else for(var c in u)u[c].call(this);return l};return this}})(jQuery,window);